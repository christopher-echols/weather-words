<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Weather Words ‚Äî Ride</title>
  <link href="https://fonts.googleapis.com/css2?family=Quattrocento:wght@700&family=Questrial&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,300,0..1,0" rel="stylesheet" />
  <style>
    :root{ --accent:#20a2ee; --accent2:#1ec278; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; padding:10%; display:flex; align-items:center; justify-content:center; text-align:center;
      font-family:'Questrial',system-ui,-apple-system,Segoe UI,Roboto,sans-serif; transition:background-color 420ms ease,color 420ms ease;}
    body.theme-neutral{background:#e9efef;color:#26364d;} body.theme-cool{background:#dfeaf0;color:#26364d;}
    body.theme-warm{background:#f3eadf;color:#3b2f2a;} body.theme-rain{background:#e6edf1;color:#22303d;}
    body.theme-snow{background:#f5f7fa;color:#2c3a4a;}
    .controls{position:fixed;top:12px;right:12px;display:flex;gap:.5rem;align-items:center;opacity:.85;z-index:10}
    .controls:hover{opacity:1}.icon-btn{background:none;border:none;cursor:pointer;font-size:1.6rem;color:var(--accent)}
    .mini{appearance:none;background:transparent;border:1px solid rgba(38,54,77,.25);color:inherit;padding:.25rem .5rem;border-radius:6px;font-size:.95rem}
    .wx-icon{line-height:1;margin:0 auto .35rem}.icon-stack{display:inline-flex;flex-direction:column;align-items:center;justify-content:center;gap:.05rem}
    .material-symbols-rounded{font-variation-settings:'FILL'0,'wght'300,'GRAD'0,'opsz'48;display:block;color:currentColor;}
    .weather-symbol{font-size:clamp(2.8rem,6.5vw,4rem);line-height:1}.bike-symbol{font-size:clamp(3.5rem,7.5vw,5rem);line-height:1;transform:translateY(-3px)}
    h1{font-family:'Quattrocento',serif;font-weight:700;font-size:clamp(2.5rem,6vw,4rem);line-height:1.1;margin:.1rem 0 1rem;letter-spacing:-0.01em;transition:color 420ms ease;}
    #weather{font-family:'Questrial',sans-serif;font-weight:400;font-size:clamp(1.5rem,4vw,2.25rem);line-height:1.35;max-width:40ch;margin:0 auto 1.25rem;letter-spacing:0.01em;transition:color 420ms ease;}
    #advice{font-family:'Quattrocento',serif;font-weight:700;font-size:clamp(1.1rem,2.5vw,1.5rem);line-height:1.35;margin-top:.75rem;letter-spacing:-0.005em;transition:color 420ms ease;}
    body.theme-neutral #advice{color:#1e7f52}body.theme-cool #advice{color:#1e7f52}body.theme-warm #advice{color:#7d5a3a}
    body.theme-rain #advice{color:#1e6a7f}body.theme-snow #advice{color:#315a7d}
    #locationInputContainer{display:none;position:fixed;top:52px;right:12px;background:#ffffffd9;color:#111;padding:.75rem;border-radius:8px;box-shadow:0 6px 24px rgba(0,0,0,.12);width:min(90vw,360px);text-align:left;z-index:11}
    #locationInputContainer input{width:100%;padding:.5rem .6rem;font-size:1rem;margin:.25rem 0 .5rem;}
    #locationInputContainer button{background:var(--accent2);color:white;border:none;border-radius:6px;padding:.45rem .7rem;font-size:1rem;cursor:pointer}
    #geoHelp{font-size:.8rem;opacity:.75;margin:.25rem 0 .3rem}#geoResults{margin-top:.4rem;max-height:220px;overflow:auto;border-top:1px solid rgba(0,0,0,.08)}
    .geo-item{padding:.45rem .2rem;cursor:pointer;border-bottom:1px solid rgba(0,0,0,.06)}.geo-item:hover{background:rgba(0,0,0,.04)}
  </style>
</head>
<body class="theme-neutral">
  <div class="controls">
    <select id="headingSelect" class="mini" title="Outbound heading">
      <option value="none">Heading</option><option value="0">N</option><option value="45">NE</option><option value="90">E</option><option value="135">SE</option><option value="180">S</option><option value="225">SW</option><option value="270">W</option><option value="315">NW</option>
    </select>
    <select id="routeType" class="mini" title="Route"><option value="outback" selected>Out & Back</option><option value="loop">Loop</option></select>
    <button class="icon-btn" onclick="toggleLocationInput()" title="Set location">üìç</button>
  </div>

  <div class="container">
    <div id="wxIcon" class="wx-icon" aria-hidden="true"><div class="icon-stack"><span class="material-symbols-rounded weather-symbol">hourglass_empty</span><span class="material-symbols-rounded bike-symbol">directions_bike</span></div></div>
    <h1 id="summary">Loading...</h1>
    <div id="weather">Fetching weather‚Ä¶</div>
    <div id="advice" class="advice">Getting your ride details‚Ä¶</div>
  </div>

  <div id="locationInputContainer">
    <label for="locationInput" style="font-size:.9rem;opacity:.8">Enter a place</label>
    <input id="locationInput" type="text" placeholder="City, ST or ZIP (US)" />
    <div id="geoHelp">Examples: <em>Knoxville, TN</em> ¬∑ <em>37902</em> ¬∑ <em>Knoxville</em> (you‚Äôll choose)</div>
    <button onclick="startGeocode()">Search</button>
    <div id="geoResults"></div>
  </div>

  <script>
    const $ = s => document.querySelector(s);
    let lastData = null;

    function seedFrom(...args){const s=args.join('|');let h=2166136261>>>0;for(let i=0;i<s.length;i++){h^=s.charCodeAt(i);h+=(h<<1)+(h<<4)+(h<<7)+(h<<8)+(h<<24);}return h>>>0;}
    function pick(list,seed){return list[seed%list.length];}
    function phraserCurrent(tempF,feelF,desc,windText,seed){const openers=["Right now it‚Äôs","Currently it‚Äôs","At the moment it‚Äôs","Now it‚Äôs"];const joins=["with","and","under","as"];const feels=[`(feels ${feelF}¬∞)`,`feels like ${feelF}¬∞`,`wind chill ${feelF}¬∞`,`apparent ${feelF}¬∞`];const opener=pick(openers,seed);const join=pick(joins,seed>>2);const feel=pick(feels,seed>>3);return`${opener} ${tempF}¬∞ ${feel} and ${desc}, ${join} ${windText}.`;}
    function phraserNext(nextSentence,seed){const bridges=["Looking ahead:","Over the next few hours:","Soon:","Next up:"];const bridge=pick(bridges,seed>>5);return`${bridge} ${nextSentence}`;}

    async function startGeocode(){const q=$('#locationInput').value.trim();if(!q)return;const resultsEl=$('#geoResults');resultsEl.innerHTML='Searching‚Ä¶';try{if(/^\d{5}$/.test(q)){const z=await fetch(`https://api.zippopotam.us/us/${q}`).then(r=>r.ok?r.json():Promise.reject());const place=z.places&&z.places[0];if(place){const lat=parseFloat(place.latitude),lon=parseFloat(place.longitude);resultsEl.innerHTML=`<div class="geo-item" data-lat="${lat}" data-lon="${lon}">${place["place name"]}, ${place["state abbreviation"]} ${q}</div>`;bindGeoPicks();return;}}const url=`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(q)}&count=5&language=en&format=json`;const g=await fetch(url).then(r=>r.json());if(g&&g.results&&g.results.length){resultsEl.innerHTML=g.results.map(r=>{const label=[r.name,r.admin1,r.country_code].filter(Boolean).join(', ');return`<div class="geo-item" data-lat="${r.latitude}" data-lon="${r.longitude}">${label}</div>`;}).join('');bindGeoPicks();}else{resultsEl.textContent='No matches. Try a ZIP or add the state abbreviation.';}}catch{resultsEl.textContent='Error finding location.';}}
    function bindGeoPicks(){document.querySelectorAll('.geo-item').forEach(el=>{el.addEventListener('click',()=>{const lat=parseFloat(el.getAttribute('data-lat'));const lon=parseFloat(el.getAttribute('data-lon'));fetchWeather(lat,lon);toggleLocationInput();});});}
  </script>
</body>
</html>
